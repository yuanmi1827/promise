<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>原生Promise_使用测试</title>
</head>
<body>

  <!-- 
    1. promise的链式调用
    2. 执行顺序问题
   -->
  <!--  
<script type="text/javascript">
  new Promise((resolve, reject) => { // 在Promise内部会同步执行executor函数
    resolve(1)
    // reject(2)
  }).then(
    value => {
      console.log('onResolved()', value)
     // return undefined
     // return 3
     // throw 4
     return new Promise((resolve, reject) => {
       // resolve(5)
       reject(6)
     })
    },
    reason => {
      console.log('onRejected()', reason)
    },
  ).then(
    value => {
      console.log('onResolved()2', value)
    },
    reason => {
      console.log('onRejected()2', reason)
    }
  )
  /* 
  then()返回的promise的结果由then()指定回调函数执行的结果决定
    什么是一个失败的promise?
        throw error  ===> reason是erro
        return 失败的promise  ==> reason是返回的promise的失败reason
    其它情况都是成功的promise
        return xxxx  ==> value是xxx
        return 成功的promise  ==> value是返回的promise的成功value

  then()返回的promise与调用then()方法的promise的结果无关
  */
</script>
 -->


<!--
测试使用
  Promise.resolve()
  Promise.reject()
  Promise.all()
  Promise.race()
-->

<script>
  const p1 = new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve(4)
    }, 100);
  })
  const p2 = Promise.resolve(Promise.resolve(5))
  const p3 = Promise.reject(6)

  Promise.all([p1, p2, 3, p3]).then(values => {
    console.log(values)
  }, reason => {
    console.log(reason)
  })
  Promise.race([p1, p3]).then(
    value => {
      console.log('成功', value)
    },
    reason => {
      console.log('失败', reason)
    },
  )
</script>


 
<!--
使用promise简单封装XMLHttpRequest对象(只支持GET)
-->
<!--
<script type="text/javascript">
  const promiseAjax = function (url) {
    return new Promise(function (resolve, reject) {

      const request = new XMLHttpRequest()
      request.open("GET", url)
      request.onreadystatechange = function () {
        if (request.readyState === 4) {
          if (request.status >= 200 && request.status < 300) {
            resolve(request.response) // 解析json得到js对象/数组
          } else {
            reject(new Error(request.statusText))
          }
        }
      }
      request.responseType = "json"
      request.setRequestHeader("Accept", "application/json")
      request.send()
    })
  }

  promiseAjax('https://api.github.com/search/users?q=aa').then(value => {
    console.log('成功了', value)
  }, reason => {
    console.log('失败了', reason)
  })
</script>-->


</body>
</html>